<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Absences - ENSA F√®s</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- BARRE DE NAVIGATION -->
    <nav class="navbar">
        <div class="navbar-logo">ENSA F√®s</div>
        <div class="navbar-nav">
            <a href="#" onclick="logout()">D√©connexion</a>
            <span id="navUser" style="margin-left:12px; font-weight:600; color:#083; display:none;"></span>
        </div>
    </nav>

    <!-- CONTENEUR PRINCIPAL -->
    <div class="gestion-container">

        <!-- EN-T√äTE -->
        <div class="gestion-header">
            <div class="header-content">
                <h1>Gestion des Absences</h1>
                <p class="header-subtitle">
                    FlowTrack : ¬´ Automatiser, organiser, r√©ussir ¬ª
                </p>
            </div>
        </div>

        <!-- CONTENU -->
        <div class="gestion-content">

            <!-- SECTION CONTR√îLES -->
            <div class="controls-section">
                <div class="controls-row">

                    <!-- FILI√àRE -->
                    <div class="control-group">
                        <label for="filiereSelect">S√©lectionner la fili√®re</label>
                        <select id="filiereSelect" onchange="loadStudents()">
                            <option value="">-- Choisir une fili√®re --</option>
                            <option value="isdia">ISDIA</option>
                            <option value="ilia">ILIA</option>
                            <option value="info">G√©nie Informatique</option>
                            <option value="logiciel">G√©nie Logiciel</option>
                            <option value="cyber">Cybers√©curit√©</option>
                        </select>
                    </div>

                    <!-- SEMAINE -->
                    <div class="control-group">
                        <label for="semaineSelect">S√©lectionner la semaine</label>
                        <select id="semaineSelect"
                                onchange="updateTableau(); updateStatistics()">
                            <option value="">-- Choisir une semaine --</option>
                        </select>
                    </div>

                    <!-- BOUTONS -->
                    <div class="btn-group">
                        <button class="btn-secondary btn-print"
                                onclick="exportToPDF()">
                            üñ®Ô∏è Imprimer PDF
                        </button>

                        <!-- ‚úÖ NOUVELLE FONCTIONNALIT√â AJOUT√âE -->
                        <button class="btn-secondary"
                                onclick="importDAT()">
                            üìÅ Importer .dat
                        </button>

                        <button class="btn-secondary"
                                onclick="resetData()">
                            ‚Ü∫ R√©initialiser
                        </button>
                    </div>

                </div>
            </div>

            <!-- Module display: shows module(s) for connected professor per filiere -->
            <div style="margin:12px 0; display:flex; gap:12px; align-items:center;">
                <label>Module: <span id="moduleLabel" style="font-weight:600;">‚Äî</span></label>
                <small id="moduleNote" style="color:#666;">Module attribu√© au professeur connect√© pour la fili√®re s√©lectionn√©e.</small>
            </div>

            <!-- TABLEAU -->
            <div id="tableContainer" style="display: none;">
                <h2 style="margin-bottom: 1.5rem; color: var(--bleu-fonce);">
                    D√©tail des Absences
                </h2>

                <div class="table-container">
                    <table class="attendance-table" id="attendanceTable">
                        <thead>
                            <tr>
                                    <th>N¬∞</th>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>Statut</th>
                                    <th>D√©tail</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Donn√©es JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- STATISTIQUES -->
            <div id="statisticsContainer"
                 class="statistics-section"
                 style="display: none;">

                <h2>üìä Statistiques Cumul√©es</h2>

                <div class="stats-cards">
                    <div class="stat-card total">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-value" id="totalStudents">0</div>
                        <div class="stat-label">Total √âtudiants</div>
                    </div>

                    <div class="stat-card present">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="totalPresent">0</div>
                        <div class="stat-label">Pr√©sents</div>
                    </div>

                    <div class="stat-card absent">
                        <div class="stat-icon">‚ùå</div>
                        <div class="stat-value" id="totalAbsent">0</div>
                        <div class="stat-label">Absents</div>
                    </div>

                    <div class="stat-card percentage">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="percentagePresent">0%</div>
                        <div class="stat-label">Taux Pr√©sence</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="attendanceChart"></canvas>
                </div>
            </div>

            <!-- √âTAT VIDE -->
            <div id="emptyState" class="empty-state">
                <p>
                    S√©lectionnez une fili√®re et une semaine
                    pour afficher le tableau
                </p>
            </div>

        </div>
    </div>

    <!-- SCRIPTS (CHEMINS CONSERV√âS) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/statistics.js"></script>

</body>
</html>

<!-- Student history modal (rendered for professors) -->
<div id="studentHistoryModal" class="modal" style="display:none;">
    <div class="modal-content">
        <button class="modal-close" id="modalCloseBtn">√ó</button>
        <h3 id="modalStudentName">Historique √©tudiant</h3>
        <p><strong>Fili√®re:</strong> <span id="modalFiliere">-</span> &nbsp; <strong>N¬∞</strong> <span id="modalNum">-</span></p>
        <div class="modal-body">
            <table class="attendance-table" id="modalHistoryTable">
                <thead><tr><th>Semaine</th><th>Statut</th><th>Module</th><th>Enseignant</th></tr></thead>
                <tbody id="modalHistoryBody"></tbody>
            </table>
        </div>
    </div>
</div>

